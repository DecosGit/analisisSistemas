<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario para aplicar a empleo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .tab-content {
            margin-top: 20px;
        }

        .nav-tabs .nav-link {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="mt-5">Formulario para aplicar a empleo</h1>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="section1-tab" data-bs-toggle="tab" data-bs-target="#section1"
                    type="button" role="tab" aria-controls="section1" aria-selected="true">Datos personales</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="section2-tab" data-bs-toggle="tab" data-bs-target="#section2" type="button"
                    role="tab" aria-controls="section2" aria-selected="false">Constancia de estudios</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="section3-tab" data-bs-toggle="tab" data-bs-target="#section3" type="button"
                    role="tab" aria-controls="section3" aria-selected="false">Experiencia laboral</button>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <% if (username && username !== null) {
                let userName = JSON.parse(username) %>
                <div class="tab-pane fade show active" id="section1" role="tabpanel" aria-labelledby="section1-tab">
                    <!-- Contenido de la Sección 1 -->
                    <form id="photoUploadForm" action="/uploadPhoto" method="POST" enctype="multipart/form-data" onsubmit="return uploadPhoto(event)">                    
                            <input type="hidden" id="cui" name="cui" value="<%= userName[0].dpi %>">
                        <!-- Botón para adjuntar foto -->
                        <div class="mb-3">
                            <label for="photo" class="form-label">Foto (formato jpg)</label>
                            <input type="file" class="form-control" id="photo" name="photo" accept="image/jpeg" required
                                onchange="handlePhotoUpload()">
                            <button type="submit" class="btn btn-primary mt-2" id="uploadPhotoButton" style="display: none;">Subir Foto</button>                        
                            <button type="button" class="btn btn-secondary mt-2" id="viewPhotoButton" style="display: none;" onclick="viewPhoto()">Ver Foto</button>
                        </div>                    
                    </form>

                    <form id="formSection1">
                        <!-- Nombre completo -->
                        <div class="mb-3">
                            <label for="fullName" class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" id="fullName" name="fullName"
                                value="<%= userName[0].nombre %> <%= userName[0].apellido %>" readonly>
                        </div>

                        <!-- Fecha de nacimiento -->
                        <div class="mb-3">
                            <label for="dob" class="form-label">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" id="dob" name="dob" required>
                        </div>

                        <!-- Estado civil -->
                        <div class="mb-3">
                            <label for="maritalStatus" class="form-label">Estado Civil</label>
                            <select class="form-select" id="maritalStatus" name="maritalStatus" required>
                                <option value="">Seleccione una opción</option>
                                <option value="soltero">Soltero</option>
                                <option value="casado">Casado</option>
                            </select>
                        </div>

                        <!-- Código único de identificación -CUI- -->
                        <div class="mb-3">
                            <label for="cui" class="form-label">Código Único de Identificación -CUI-</label>
                            <input type="text" class="form-control" id="cui" name="cui" value="<%= userName[0].dpi %>"
                                readonly>
                        </div>

                        <!-- Dirección de residencia -->
                        <div class="mb-3">
                            <label for="residenceAddress" class="form-label">Dirección de Residencia</label>
                            <textarea class="form-control" id="residenceAddress" name="residenceAddress" rows="3"
                                required></textarea>
                        </div>

                        <!-- Dirección para recibir notificaciones -->
                        <div class="mb-3">
                            <label for="notificationAddress" class="form-label">Dirección para Recibir Notificaciones</label>
                            <textarea class="form-control" id="notificationAddress" name="notificationAddress" rows="3"
                                required></textarea>
                        </div>

                        <!-- Números telefónicos -->
                        <div class="mb-3">
                            <label for="phoneNumbers" class="form-label">Números Telefónicos</label>
                            <input type="text" class="form-control" id="phoneNumbers" name="phoneNumbers" required>
                        </div>

                        <!-- Correo electrónico -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="email" name="email"
                                value="<%= userName[0].correo_electronico %>" readonly>
                        </div>

                        <!-- Nacionalidad -->
                        <div class="mb-3">
                            <label for="nationality" class="form-label">Nacionalidad</label>
                            <input type="text" class="form-control" id="nationality" name="nationality" required>
                        </div>

                        <!-- Profesión u Oficio -->
                        <div class="mb-3">
                            <label for="profession" class="form-label">Profesión u Oficio</label>
                            <select class="form-select" id="profession" name="profession" required>
                                <option value="">Seleccione una opción</option>
                                <option value="bachiller">Bachiller</option>
                                <option value="perito contador">Perito Contador</option>
                                <option value="secretaria">Secretaria</option>
                                <option value="ingeniero">Ingeniero</option>
                                <option value="licenciado">Licenciado</option>
                                <option value="doctor">Doctor</option>
                            </select>
                        </div>

                        <!-- Número de identificación tributaria -NIT- -->
                        <div class="mb-3">
                            <label for="nit" class="form-label">Número de Identificación Tributaria -NIT-</label>
                            <input type="text" class="form-control" id="nit" name="nit" required>
                        </div>
                        
                        <!-- Sexo -->
                        <div class="mb-3">
                            <label for="sex" class="form-label">Sexo</label>
                            <select class="form-select" id="sex" name="sex" required>
                                <option value="">Seleccione una opción</option>
                                <option value="masculino">Masculino</option>
                                <option value="femenino">Femenino</option>
                            </select>
                        </div>

                        <button type="button" class="btn btn-primary" onclick="nextTab(2)">Siguiente</button>
                    </form>
                </div>
                <div class="tab-pane fade" id="section2" role="tabpanel" aria-labelledby="section2-tab">
                    <!-- Contenido de la Sección 2 -->
                    <form id="formSection2">
                        <!-- Campos de la Sección 2 -->
                        <div class="mb-3">
                            <label for="document" class="form-label">Documento</label>
                            <input type="file" class="form-control" id="document" required>
                        </div>
                        <!-- Otros campos -->
                        <button type="button" class="btn btn-secondary" onclick="prevTab(1)">Anterior</button>
                        <button type="button" class="btn btn-primary" onclick="nextTab(3)">Siguiente</button>
                    </form>
                </div>
                <div class="tab-pane fade" id="section3" role="tabpanel" aria-labelledby="section3-tab">
                    <!-- Contenido de la Sección 3 -->
                    <form id="formSection3">
                        <!-- Campos de la Sección 3 -->
                        <div class="mb-3">
                            <label for="comments" class="form-label">Comentarios</label>
                            <textarea class="form-control" id="comments" rows="3" required></textarea>
                        </div>
                        <!-- Otros campos -->
                        <button type="button" class="btn btn-secondary" onclick="prevTab(2)">Anterior</button>
                        <button type="submit" class="btn btn-success">Enviar</button>
                    </form>
                </div>
            <% } %>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
    <script>
        function nextTab(tabIndex) {
            var nextTab = document.querySelector('#myTab button[data-bs-target="#section' + tabIndex + '"]');
            var tab = new bootstrap.Tab(nextTab);
            tab.show();
        }

        function prevTab(tabIndex) {
            var prevTab = document.querySelector('#myTab button[data-bs-target="#section' + tabIndex + '"]');
            var tab = new bootstrap.Tab(prevTab);
            tab.show();
        }

        function handlePhotoUpload() {
            const photoInput = document.getElementById('photo');
            const uploadPhotoButton = document.getElementById('uploadPhotoButton');
            const viewPhotoButton = document.getElementById('viewPhotoButton');
            if (photoInput.files.length > 0) {
                uploadPhotoButton.style.display = 'block';
                viewPhotoButton.style.display = 'block';
            } else {
                uploadPhotoButton.style.display = 'none';
                viewPhotoButton.style.display = 'none';
            }
        }

        function viewPhoto() {
            const photoInput = document.getElementById('photo');
            const file = photoInput.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                window.open(url, '_blank');
            }
        }

        function validatePhotoUpload() {
            const photoInput = document.getElementById('photo');
            if (photoInput.files.length === 0) {
                alert('Por favor, seleccione una foto para subir.');
                return false;
            }
            return true;
        }

        async function uploadPhoto(event) {
            event.preventDefault();
            const form = document.getElementById('photoUploadForm');
            const formData = new FormData(form);
            try {
                const response = await fetch('/uploadPhoto', {
                    method: 'POST',
                    body: formData
                });
                if (response.ok) {
                    alert('Foto subida exitosamente.');
                    document.getElementById('viewPhotoButton').style.display = 'block';
                } else {
                    alert('Error al subir la foto.');
                }
            } catch (error) {
                alert('Error al subir la foto.');
            }
        }
    </script>
</body>

</html>