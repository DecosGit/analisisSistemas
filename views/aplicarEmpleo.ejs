<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario para aplicar a empleo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .tab-content {
            margin-top: 20px;
        }

        .nav-tabs .nav-link {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="mt-5">Formulario para aplicar a empleo</h1>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="section1-tab" data-bs-toggle="tab" data-bs-target="#section1"
                    type="button" role="tab" aria-controls="section1" aria-selected="true">Datos personales</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="section2-tab" data-bs-toggle="tab" data-bs-target="#section2" type="button"
                    role="tab" aria-controls="section2" aria-selected="false">Constancia de estudios</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="section3-tab" data-bs-toggle="tab" data-bs-target="#section3" type="button"
                    role="tab" aria-controls="section3" aria-selected="false">Experiencia laboral</button>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <% if (username && username !== null) {
                let userName = JSON.parse(username) %>
                <div class="tab-pane fade show active" id="section1" role="tabpanel" aria-labelledby="section1-tab">
                    <!-- Contenido de la Sección 1 -->
                    <form id="photoUploadForm" action="/uploadPhoto" method="POST" enctype="multipart/form-data" onsubmit="return uploadPhoto(event)">                    
                            <input type="hidden" id="cui" name="cui" value="<%= userName[0].dpi %>">
                        <!-- Botón para adjuntar foto -->
                        <div class="mb-3">
                            <label for="photo" class="form-label">Foto (formato jpg)</label>
                            <input type="file" class="form-control" id="photo" name="photo" accept="image/jpeg" required
                                onchange="handlePhotoUpload()">
                            <button type="submit" class="btn btn-primary mt-2" id="uploadPhotoButton" style="display: none;">Subir Foto</button>                        
                            <button type="button" class="btn btn-secondary mt-2" id="viewPhotoButton" style="display: none;" onclick="viewPhoto()">Ver Foto</button>
                        </div>                    
                    </form>

                    <form id="formSection1">
                        <!-- Nombre completo -->
                        <div class="mb-3">
                            <label for="fullName" class="form-label">Nombre Completo</label>
                            <input type="text" class="form-control" id="fullName" name="fullName"
                                value="<%= userName[0].nombre %> <%= userName[0].apellido %>" readonly>
                        </div>

                        <!-- Fecha de nacimiento -->
                        <div class="mb-3">
                            <label for="dob" class="form-label">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" id="dob" name="dob" required>
                        </div>

                        <!-- Estado civil -->
                        <div class="mb-3">
                            <label for="maritalStatus" class="form-label">Estado Civil</label>
                            <select class="form-select" id="maritalStatus" name="maritalStatus" required>
                                <option value="">Seleccione una opción</option>
                                <option value="soltero">Soltero</option>
                                <option value="casado">Casado</option>
                            </select>
                        </div>

                        <!-- Código único de identificación -CUI- -->
                        <div class="mb-3">
                            <label for="cui" class="form-label">Código Único de Identificación -CUI-</label>
                            <input type="text" class="form-control" id="cui" name="cui" value="<%= userName[0].dpi %>"
                                readonly>
                        </div>

                        <!-- Dirección de residencia -->
                        <div class="mb-3">
                            <label for="residenceAddress" class="form-label">Dirección de Residencia</label>
                            <textarea class="form-control" id="residenceAddress" name="residenceAddress" rows="3"
                                required></textarea>
                        </div>

                        <!-- Dirección para recibir notificaciones -->
                        <div class="mb-3">
                            <label for="notificationAddress" class="form-label">Dirección para Recibir Notificaciones</label>
                            <textarea class="form-control" id="notificationAddress" name="notificationAddress" rows="3"
                                required></textarea>
                        </div>

                        <!-- Números telefónicos -->
                        <div class="mb-3">
                            <label for="phoneNumbers" class="form-label">Números Telefónicos</label>
                            <input type="text" class="form-control" id="phoneNumbers" name="phoneNumbers" required>
                        </div>

                        <!-- Correo electrónico -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="email" name="email"
                                value="<%= userName[0].correo_electronico %>" readonly>
                        </div>

                        <!-- Nacionalidad -->
                        <div class="mb-3">
                            <label for="nationality" class="form-label">Nacionalidad</label>
                            <input type="text" class="form-control" id="nationality" name="nationality" required>
                        </div>

                        <!-- Profesión u Oficio -->
                        <div class="mb-3">
                            <label for="profession" class="form-label">Profesión u Oficio</label>
                            <select class="form-select" id="profession" name="profession" required>
                                <option value="">Seleccione una opción</option>
                                <option value="bachiller">Bachiller</option>
                                <option value="perito contador">Perito Contador</option>
                                <option value="secretaria">Secretaria</option>
                                <option value="ingeniero">Ingeniero</option>
                                <option value="licenciado">Licenciado</option>
                                <option value="doctor">Doctor</option>
                            </select>
                        </div>

                        <!-- Número de identificación tributaria -NIT- -->
                        <div class="mb-3">
                            <label for="nit" class="form-label">Número de Identificación Tributaria -NIT-</label>
                            <input type="text" class="form-control" id="nit" name="nit" required>
                        </div>
                        
                        <!-- Sexo -->
                        <div class="mb-3">
                            <label for="sex" class="form-label">Sexo</label>
                            <select class="form-select" id="sex" name="sex" required>
                                <option value="">Seleccione una opción</option>
                                <option value="masculino">Masculino</option>
                                <option value="femenino">Femenino</option>
                            </select>
                        </div>

                        <button type="button" class="btn btn-primary" onclick="nextTab(2)">Siguiente</button>
                    </form>
                </div>
                <div class="tab-pane fade" id="section2" role="tabpanel" aria-labelledby="section2-tab">
                    <!-- Contenido de la Sección 2 -->
                    <form id="formSection2">
                        <div class="mb-3">
                            <label for="studyType" class="form-label">Tipo de Estudio</label>
                            <select class="form-select" id="studyType" name="studyType" onchange="updateStudyForm()" required>
                                <option value="">Seleccione una opción</option>
                                <option value="primario">Primario</option>
                                <option value="secundario">Secundario</option>
                                <option value="diversificado">Diversificado</option>
                                <option value="universitario">Universitario</option>
                            </select>
                        </div>
    
                        <div id="studyFields">
                            <!-- Campos específicos de estudio se generarán dinámicamente aquí -->
                        </div>
    
                        <button type="button" class="btn btn-primary" onclick="addStudy()">Agregar Estudio</button>
                    </form>
    
                    <table class="table mt-3" id="studiesTable">
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Año Inicio</th>
                                <th>Año Fin</th>
                                <th>Establecimiento</th>
                                <th>Título/Diploma</th>
                                <th>Documento</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Las filas de estudios agregados se generarán dinámicamente aquí -->
                        </tbody>
                    </table>
    
                    <button type="button" class="btn btn-secondary" onclick="prevTab(1)">Anterior</button>
                    <button type="button" class="btn btn-primary" onclick="nextTab(3)">Siguiente</button>
                </div>
                <div class="tab-pane fade" id="section3" role="tabpanel" aria-labelledby="section3-tab">
                    <!-- Contenido de la Sección 3 -->
                    <form id="formSection3">
                        <!-- Campos de la Sección 3 -->
                        <div class="mb-3">
                            <label for="comments" class="form-label">Comentarios</label>
                            <textarea class="form-control" id="comments" rows="3" required></textarea>
                        </div>
                        <!-- Otros campos -->
                        <button type="button" class="btn btn-secondary" onclick="prevTab(2)">Anterior</button>
                        <button type="submit" class="btn btn-success">Enviar</button>
                    </form>
                </div>
            <% } %>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
    <script>
        let studies = [];

        function nextTab(tabIndex) {
            var nextTab = document.querySelector('#myTab button[data-bs-target="#section' + tabIndex + '"]');
            var tab = new bootstrap.Tab(nextTab);
            tab.show();
        }

        function prevTab(tabIndex) {
            var prevTab = document.querySelector('#myTab button[data-bs-target="#section' + tabIndex + '"]');
            var tab = new bootstrap.Tab(prevTab);
            tab.show();
        }

        function updateStudyForm() {
            const studyType = document.getElementById('studyType').value;
            const studyFields = document.getElementById('studyFields');
            studyFields.innerHTML = '';

            if (studyType) {
                let fieldsHTML = `
                    <div class="mb-3">
                        <label for="startYear" class="form-label">Año Inicio</label>
                        <input type="number" class="form-control" id="startYear" name="startYear" required>
                    </div>
                    <div class="mb-3">
                        <label for="endYear" class="form-label">Año Fin</label>
                        <input type="number" class="form-control" id="endYear" name="endYear" required>
                    </div>
                    <div class="mb-3">
                        <label for="establishment" class="form-label">Establecimiento</label>
                        <input type="text" class="form-control" id="establishment" name="establishment" required>
                    </div>
                    <div class="mb-3">
                        <label for="degree" class="form-label">Título/Diploma Obtenido</label>
                        <input type="text" class="form-control" id="degree" name="degree" required>
                    </div>
                `;

                if (studyType === 'universitario') {
                    fieldsHTML += `
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="isCompleted" name="isCompleted">
                            <label for="isCompleted" class="form-check-label">¿Finalizado?</label>
                        </div>
                    `;
                }

                studyFields.innerHTML = fieldsHTML;
            }
        }

        function addStudy() {
            const studyType = document.getElementById('studyType').value;
            const startYear = document.getElementById('startYear').value;
            const endYear = document.getElementById('endYear').value;
            const establishment = document.getElementById('establishment').value;
            const degree = document.getElementById('degree').value;
            const isCompleted = studyType === 'universitario' ? document.getElementById('isCompleted').checked : null;

            const study = {
                type: studyType,
                startYear: startYear,
                endYear: endYear,
                establishment: establishment,
                degree: degree,
                isCompleted: isCompleted,
                document: null
            };

            studies.push(study);
            updateStudiesTable();
        }

        function updateStudiesTable() {
            const studiesTableBody = document.querySelector('#studiesTable tbody');
            studiesTableBody.innerHTML = '';

            studies.forEach((study, index) => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${study.type}</td>
                    <td>${study.startYear}</td>
                    <td>${study.endYear}</td>
                    <td>${study.establishment}</td>
                    <td>${study.degree}</td>
                    <td>${study.type === 'universitario' ? `<input type="file" onchange="handleDocumentUpload(${index}, this)" required>` : ''}</td>
                    <td><button class="btn btn-danger" onclick="removeStudy(${index})">Eliminar</button></td>
                `;

                studiesTableBody.appendChild(row);
            });
        }

        function handleDocumentUpload(index, input) {
            const file = input.files[0];
            if (file) {
                studies[index].document = file;
            }
        }

        function removeStudy(index) {
            studies.splice(index, 1);
            updateStudiesTable();
        }
    </script>
</body>

</html>
